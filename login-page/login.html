<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' https://api.fein-ai.com https://www.google.com https://www.gstatic.com;
  connect-src 'self' https://api.fein-ai.com;
  style-src 'self' 'unsafe-inline';
  frame-src https://www.google.com https://www.gstatic.com;">
  <title>Fein AI Login</title>
  <link rel="stylesheet" href="login.css" />
  <!-- Phosphor Icons CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/regular/style.css" />
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
  <canvas id="stars"></canvas>
  <div class="container">
    <div class="left">
      <div class="left-content">
        <div class="logo-section">
          <img src="company-logo.png" alt="Company Logo" class="company-logo" />
        </div>
        <h1>Your Financial Journey<br>starts here</h1>
        <p>Create an account to Join Our Community</p>
      </div>

      <div class="bottom-section">
        <div class="follow-inline">
          <p class="follow-us-text">Follow us on</p>
        </div>
        <div class="bottom-socials">
          <a href="#" id="instagram-btn"><img src="assets/instagram.svg" alt="Instagram" /></a>
          <a href="#" id="twitter-btn"><img src="assets/twitter.svg" alt="Twitter" /></a>
          <a href="#" id="linkedin-btn"><img src="assets/linkedin.svg" alt="LinkedIn" /></a>
        </div>
      </div>
    </div>

    <div class="right">
      <div class="form-box">
        <h2>Hello! Welcome to Fein AI</h2>
        <form id="login-form" action="https://api.fein-ai.com/v1/login" method="POST">
          <label>Email ID</label>
          <input type="email" id="login-email" placeholder="Enter your email" required />
          <div id="email-error" class="error-message"></div>

          <label>Password</label>
          <div style="position: relative;">
            <input type="password" id="login-password" placeholder="Password" required style="padding-right: 38px;" />
            <span id="toggle-password" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #ddf1a5; font-size: 1.2em;">
              <i class="ph ph-eye"></i>
            </span>
          </div>
          <div id="password-error" class="error-message"></div>
          <div class="g-recaptcha" data-sitekey="6LdAfpgrAAAAACIZhDigtnnxk-xCDR0OSWBaQbUP"></div>
          <br/>

          <div class="options">
            <label><input type="checkbox" id="remember-me" /> Remember Me</label>
            <a href="#" id="forgot-password">Forgot Password?</a>
          </div>

          <button type="submit">Login</button>
          <div class="divider">or</div>
          <div class="socials"> 
            <a href="#" id="google-login"><i class="ph ph-google-logo"></i></a>
            <a href="#" id="apple-login"><i class="ph ph-apple-logo"></i></a>
          </div>
          <p class="bottom-text">New to Fein AI? <a href="#" id="signup-now">Signup now</a></p>
        </form>
        <p>By logging in, you agree to our <br><a href="privacy-notice.html" style="color: #ddf1a5; text-decoration: underline; font-size: clamp(0.8em, 1.8vw, 0.9em); font-weight: 500;">Privacy Notice</a>.</p>
      </div>
    </div>
  </div>
  <script>
    form.addEventListener('submit', function (e) {
  e.preventDefault();

  // Prevent further login if limit reached
  if (loginAttempts >= maxAttempts) {
    pwdError.textContent = `ðŸš« Too many failed attempts. Try again in 30 seconds.`;
    return;
  }

  let valid = true;
  emailError.textContent = '';
  pwdError.textContent = '';

  const email = emailInput.value.trim();
  const pwd = pwdInput.value.trim();

  if (!/\S+@\S+\.\S+/.test(email)) {
    emailError.textContent = "Please enter a valid email address.";
    valid = false;
  }

  if (!pwd) {
    pwdError.textContent = "Password cannot be empty.";
    valid = false;
  }

  // âœ… Check reCAPTCHA
  const recaptchaResponse = grecaptcha.getResponse();
  if (recaptchaResponse.length === 0) {
    pwdError.textContent = "Please complete the reCAPTCHA.";
    valid = false;
  }

  if (!valid) {
    console.warn("Form validation failed.");
    return;
  }

  console.log("Sending login request...");

  fetch("https://api.fein-ai.com/v1/login/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    credentials: "include", 
    body: JSON.stringify({
      email: email,
      password: pwd,
      recaptcha: recaptchaResponse  // send token if needed on backend
    })
  })
  .then(async response => {
    const contentType = response.headers.get("content-type");
    let data;

    try {
      data = contentType && contentType.includes("application/json")
        ? await response.json()
        : { message: await response.text() };
    } catch (e) {
      console.error("Failed to parse response:", e);
      pwdError.textContent = "Invalid server response.";
      return;
    }

    console.log("Login response status:", response.status);
    console.log("Login response data:", data);

    if (data.status === "ok") {
      loginAttempts = 0;
      alert("Welcome back!");
      window.location.href = "../question/index.html";
    } else {
      loginAttempts++;
      pwdError.textContent = data.message || "Invalid login credentials.";

      if (loginAttempts >= maxAttempts) {
        const loginBtn = form.querySelector('button[type="submit"]');
        loginBtn.disabled = true;
        pwdError.textContent = "ðŸš« Too many failed attempts. Try again in 30 seconds.";

        setTimeout(() => {
          loginAttempts = 0;
          loginBtn.disabled = false;
          pwdError.textContent = "";
        }, lockoutTime);
      }
    }
  })
  .catch(err => {
    console.error("Network or server error during login:", err);
    pwdError.textContent = "Server error. Please try again later.";
  });
});
  </script>
  <script src="login.js"></script>
</body>
</html>
